<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WINNIX Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: white; overflow-x: hidden; }
        .spin-animation { animation: spin 3s cubic-bezier(0.15, 0, 0.15, 1) forwards; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(1080deg); } }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="pb-20">

    <div id="app">
        <!-- Loading State -->
        <div id="loading" class="fixed inset-0 z-[200] bg-[#0f172a] flex flex-col items-center justify-center">
            <div class="w-16 h-16 border-4 border-[#a3ff00] border-t-transparent rounded-full animate-spin mb-4"></div>
            <h1 class="text-2xl font-black">WIN<span class="text-[#a3ff00]">NIX</span></h1>
        </div>

        <!-- Auth Screen (Hidden by default) -->
        <div id="auth-screen" class="hidden min-h-screen flex items-center justify-center p-4">
            <div class="bg-[#1e293b] w-full max-w-md rounded-3xl p-8 border border-slate-700">
                <h1 class="text-4xl font-black text-center mb-8">WIN<span class="text-[#a3ff00]">NIX</span></h1>
                <div class="space-y-4">
                    <input id="auth-email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 outline-none focus:border-[#a3ff00]">
                    <input id="auth-password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 outline-none focus:border-[#a3ff00]">
                    <div id="auth-error" class="text-red-500 text-xs text-center hidden"></div>
                    <button id="btn-login" class="w-full bg-[#a3ff00] text-black font-black py-4 rounded-xl shadow-lg active:scale-95 transition-all">Ø¯Ø®ÙˆÙ„</button>
                    <button id="btn-signup" class="w-full text-slate-400 text-sm mt-2">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
                </div>
            </div>
        </div>

        <!-- Main Content (Hidden by default) -->
        <div id="main-content" class="hidden">
            <!-- Header -->
            <header class="sticky top-0 z-50 bg-[#162032]/80 backdrop-blur-md border-b border-slate-800 p-4 flex justify-between items-center">
                <div class="font-black text-2xl">WIN<span class="text-[#a3ff00]">NIX</span></div>
                <div class="flex items-center gap-3">
                    <div class="bg-slate-900 border border-slate-700 px-4 py-1 rounded-full text-center">
                        <span class="text-[10px] text-slate-500 block">Ø±ØµÙŠØ¯Ùƒ</span>
                        <span id="display-balance" class="text-[#a3ff00] font-black">0.00</span>
                    </div>
                    <button onclick="showModal('profile')" class="p-2 bg-slate-800 rounded-lg"><i data-lucide="user"></i></button>
                </div>
            </header>

            <main class="p-4 max-w-4xl mx-auto space-y-6">
                <!-- Daily Reward Card -->
                <div class="bg-[#1e293b] p-6 rounded-3xl border border-slate-700 text-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10"><i data-lucide="gift" size="80"></i></div>
                    <h2 class="text-xl font-black mb-4 flex items-center justify-center gap-2 text-[#a3ff00]">
                        <i data-lucide="zap"></i> Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                    </h2>
                    <div id="wheel-container" class="w-40 h-40 mx-auto rounded-full border-4 border-slate-800 flex items-center justify-center bg-slate-900 mb-6 transition-all duration-500">
                        <span id="wheel-icon" class="text-5xl">ğŸ</span>
                    </div>
                    <div id="reward-status" class="text-slate-400 text-sm mb-4">Ø§Ø±Ø¨Ø­ Ù…ÙŠØ²Ø§Øª Ø®Ø§ØµØ© ÙˆÙ…Ø¨Ø§Ù„Øº Ù†Ù‚Ø¯ÙŠØ© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©!</div>
                    <button id="btn-spin" class="w-full bg-[#a3ff00] text-black font-black py-3 rounded-xl shadow-lg disabled:opacity-50">Ø§Ø³Ø­Ø¨ Ù‡Ø¯ÙŠØªÙƒ Ø§Ù„Ø¢Ù†</button>
                </div>

                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="showModal('deposit')" class="py-4 bg-blue-600 rounded-2xl font-black flex items-center justify-center gap-2"><i data-lucide="wallet"></i> Ø¥ÙŠØ¯Ø§Ø¹</button>
                    <button onclick="showModal('withdraw')" class="py-4 bg-emerald-600 rounded-2xl font-black flex items-center justify-center gap-2"><i data-lucide="arrow-down-circle"></i> Ø³Ø­Ø¨</button>
                </div>

                <!-- Game Grid -->
                <h2 class="text-xl font-black mt-8">Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 relative overflow-hidden group active:scale-95 transition-all">
                        <div class="bg-red-500/20 w-12 h-12 rounded-xl flex items-center justify-center text-red-500 mb-4"><i data-lucide="rocket"></i></div>
                        <div class="font-black text-lg">Aviator X</div>
                        <div class="text-[10px] text-slate-500 mt-1">Ø§Ø¶Ø±Ø¨ Ø±Ù‡Ø§Ù†Ùƒ ÙÙŠ 100</div>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 relative overflow-hidden group active:scale-95 transition-all">
                        <div class="bg-blue-500/20 w-12 h-12 rounded-xl flex items-center justify-center text-blue-500 mb-4"><i data-lucide="bomb"></i></div>
                        <div class="font-black text-lg">Mines Pro</div>
                        <div class="text-[10px] text-slate-500 mt-1">ØªØ¬Ù†Ø¨ Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ Ù„ØªØ±Ø¨Ø­</div>
                    </div>
                </div>
            </main>

            <!-- Footer Navigation -->
            <footer class="fixed bottom-0 inset-x-0 bg-[#162032]/95 backdrop-blur-xl border-t border-slate-800 flex justify-around p-3">
                <button class="text-[#a3ff00] flex flex-col items-center"><i data-lucide="gamepad-2"></i><span class="text-[10px]">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
                <button onclick="showModal('deposit')" class="text-slate-400 flex flex-col items-center"><i data-lucide="plus-circle"></i><span class="text-[10px]">Ø´Ø­Ù†</span></button>
                <button onclick="showModal('withdraw')" class="text-slate-400 flex flex-col items-center"><i data-lucide="trending-up"></i><span class="text-[10px]">Ø£Ø±Ø¨Ø§Ø­</span></button>
                <button onclick="showModal('profile')" class="text-slate-400 flex flex-col items-center"><i data-lucide="user-circle"></i><span class="text-[10px]">Ø­Ø³Ø§Ø¨ÙŠ</span></button>
            </footer>
        </div>

        <!-- Modals Container -->
        <div id="modal-overlay" class="fixed inset-0 z-[100] bg-black/90 flex items-center justify-center p-4 hidden">
            <!-- Deposit Modal -->
            <div id="modal-deposit" class="modal-content bg-[#1e293b] w-full max-w-md rounded-3xl p-8 border border-slate-700 relative hidden">
                <button onclick="hideModal()" class="absolute left-6 top-6 text-slate-500"><i data-lucide="x"></i></button>
                <h2 class="text-2xl font-black mb-6">Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</h2>
                <div class="bg-blue-600/10 border border-blue-500/30 p-4 rounded-xl mb-6">
                    <p class="text-xs text-blue-400 mb-1">Ø­ÙˆÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´:</p>
                    <div class="flex justify-between items-center">
                        <span class="font-mono text-xl font-bold tracking-widest text-white">01014879247</span>
                        <button onclick="copyNumber()" class="bg-blue-600 p-2 rounded-lg text-white"><i data-lucide="copy" size="16"></i></button>
                    </div>
                </div>
                <div class="space-y-4">
                    <input id="dep-phone" type="text" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ Ø­ÙˆÙ„Øª Ù…Ù†Ù‡" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-800 outline-none">
                    <input id="dep-amount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-800 outline-none">
                    <button onclick="submitDeposit()" class="w-full bg-[#a3ff00] text-black font-black py-4 rounded-xl">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙØ¹ÙŠÙ„ (ÙˆØ§ØªØ³Ø§Ø¨)</button>
                </div>
            </div>

            <!-- Withdraw Modal -->
            <div id="modal-withdraw" class="modal-content bg-[#1e293b] w-full max-w-md rounded-3xl p-8 border border-slate-700 relative hidden">
                <button onclick="hideModal()" class="absolute left-6 top-6 text-slate-500"><i data-lucide="x"></i></button>
                <h2 class="text-2xl font-black mb-6 text-emerald-500">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h2>
                <div class="space-y-4">
                    <input id="wd-phone" type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ÙƒØ§Ø´" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-800 outline-none">
                    <input id="wd-amount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ù„Ø£Ø¯Ù†Ù‰ 50)" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-800 outline-none">
                    <div id="wd-error" class="text-red-500 text-xs text-center hidden"></div>
                    <button onclick="submitWithdraw()" class="w-full bg-emerald-600 text-white font-black py-4 rounded-xl">ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨</button>
                </div>
            </div>

            <!-- Profile Modal -->
            <div id="modal-profile" class="modal-content bg-[#1e293b] w-full max-w-md rounded-3xl p-8 border border-slate-700 relative hidden">
                <button onclick="hideModal()" class="absolute left-6 top-6 text-slate-500"><i data-lucide="x"></i></button>
                <div class="text-center pt-4">
                    <div class="w-20 h-20 bg-slate-800 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-[#a3ff00]"><i data-lucide="user" size="40" class="text-[#a3ff00]"></i></div>
                    <h2 id="prof-email" class="font-bold mb-1">---</h2>
                    <p id="prof-id" class="text-slate-500 text-sm mb-6">ID: WIN-000000</p>
                    <div class="bg-slate-900 p-6 rounded-2xl mb-6">
                        <p class="text-slate-500 text-xs mb-1">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„ÙƒÙ„ÙŠ</p>
                        <p id="prof-balance" class="text-[#a3ff00] text-4xl font-black">0.00</p>
                    </div>
                    <button id="btn-logout" class="w-full bg-red-500/10 text-red-500 border border-red-500/20 py-3 rounded-xl flex items-center justify-center gap-2"><i data-lucide="log-out"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDhHkYb1tFSSbxaQejvYl2vrI5fN1MVpcs",
            authDomain: "chatu-e5f5f.firebaseapp.com",
            projectId: "chatu-e5f5f",
            storageBucket: "chatu-e5f5f.firebasestorage.app",
            messagingSenderId: "625361934723",
            appId: "1:625361934723:web:b1b204c1d538a5e875beb6"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'winnix-v1-production';

        let currentUser = null;
        let userData = null;

        // UI Initialization
        lucide.createIcons();

        // App States
        const updateUI = () => {
            if (currentUser) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('loading').classList.add('hidden');
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('main-content').classList.add('hidden');
                document.getElementById('loading').classList.add('hidden');
            }
        };

        // Auth Logic
        document.getElementById('btn-login').onclick = async () => {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-password').value;
            const errDiv = document.getElementById('auth-error');
            try {
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (e) {
                try {
                    const userCred = await createUserWithEmailAndPassword(auth, email, pass);
                    await setDoc(doc(db, 'artifacts', appId, 'users', userCred.user.uid, 'profile'), {
                        balance: 0,
                        email: email,
                        userId: `WIN-${Math.floor(100000 + Math.random() * 900000)}`,
                        createdAt: Date.now()
                    });
                } catch (err) {
                    errDiv.innerText = "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
                    errDiv.classList.remove('hidden');
                }
            }
        };

        document.getElementById('btn-logout').onclick = () => signOut(auth);

        // Auth State Listener
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                onSnapshot(doc(db, 'artifacts', appId, 'users', user.uid, 'profile'), (snap) => {
                    if (snap.exists()) {
                        userData = snap.data();
                        document.getElementById('display-balance').innerText = userData.balance.toFixed(2);
                        document.getElementById('prof-balance').innerText = userData.balance.toFixed(2);
                        document.getElementById('prof-email').innerText = userData.email;
                        document.getElementById('prof-id').innerText = `ID: ${userData.userId}`;
                    }
                });
                checkDailySpin();
            }
            updateUI();
        });

        // Global Modals Helper
        window.showModal = (type) => {
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.querySelectorAll('.modal-content').forEach(m => m.classList.add('hidden'));
            document.getElementById(`modal-${type}`).classList.remove('hidden');
        };

        window.hideModal = () => {
            document.getElementById('modal-overlay').classList.add('hidden');
        };

        window.copyNumber = () => {
            const num = "01014879247";
            const el = document.createElement('textarea');
            el.value = num;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù… Ø¨Ù†Ø¬Ø§Ø­");
        };

        // Transaction Logic
        window.submitDeposit = () => {
            const phone = document.getElementById('dep-phone').value;
            const amount = document.getElementById('dep-amount').value;
            if(!phone || !amount) return;
            const msg = `Ø·Ù„Ø¨ Ø¥ÙŠØ¯Ø§Ø¹ Ø¬Ø¯ÙŠØ¯:%0AØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userData.userId}%0AØ±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„: ${phone}%0AØ§Ù„Ù…Ø¨Ù„Øº: ${amount} EGP`;
            window.open(`https://wa.me/201012265953?text=${msg}`, '_blank');
            hideModal();
        };

        window.submitWithdraw = async () => {
            const phone = document.getElementById('wd-phone').value;
            const amount = parseFloat(document.getElementById('wd-amount').value);
            const errDiv = document.getElementById('wd-error');
            
            if(!phone || isNaN(amount) || amount < 50) {
                errDiv.innerText = "Ø£Ù‚Ù„ Ù…Ø¨Ù„Øº Ø³Ø­Ø¨ 50 Ø¬Ù†ÙŠÙ‡";
                errDiv.classList.remove('hidden');
                return;
            }
            if(userData.balance < amount) {
                errDiv.innerText = "Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ";
                errDiv.classList.remove('hidden');
                return;
            }

            await updateDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'profile'), {
                balance: userData.balance - amount
            });
            const msg = `Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø£Ø±Ø¨Ø§Ø­:%0AØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userData.userId}%0AØ±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: ${phone}%0AØ§Ù„Ù…Ø¨Ù„Øº: ${amount} EGP`;
            window.open(`https://wa.me/201012265953?text=${msg}`, '_blank');
            hideModal();
        };

        // Daily Reward Logic
        async function checkDailySpin() {
            const spinDoc = await getDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'rewards', 'daily'));
            if (spinDoc.exists()) {
                const last = spinDoc.data().timestamp;
                if (Date.now() - last < 86400000) {
                    document.getElementById('btn-spin').disabled = true;
                    document.getElementById('btn-spin').innerText = "Ø¹Ø¯ Ù„Ø§Ø­Ù‚Ø§Ù‹ ØºØ¯Ø§Ù‹";
                }
            }
        }

        document.getElementById('btn-spin').onclick = async () => {
            const btn = document.getElementById('btn-spin');
            const wheel = document.getElementById('wheel-container');
            const icon = document.getElementById('wheel-icon');
            
            btn.disabled = true;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø³Ø­Ø¨...";
            wheel.classList.add('spin-animation');

            setTimeout(async () => {
                wheel.classList.remove('spin-animation');
                const winAmount = (Math.random() * 5).toFixed(2); // Random small reward
                icon.innerText = "ğŸ’°";
                document.getElementById('reward-status').innerHTML = `<span class="text-[#a3ff00] font-bold">Ø±Ø¨Ø­Øª ${winAmount} EGP Ø±ØµÙŠØ¯ Ù…Ø¬Ø§Ù†ÙŠ!</span>`;
                
                await updateDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'profile'), {
                    balance: userData.balance + parseFloat(winAmount)
                });
                await setDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'rewards', 'daily'), {
                    timestamp: Date.now()
                });
            }, 3000);
        };

    </script>
</body>
</html>

