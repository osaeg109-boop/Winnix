<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Winnix EG - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø¹Ø¯Ù„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0b0f1a; color: white; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .crash-canvas-container { position: relative; height: 300px; background: radial-gradient(circle at bottom left, #1e293b, #0b0f1a); border-radius: 20px; overflow: hidden; border: 1px solid #334155; }
        .rocket { position: absolute; bottom: 10%; left: 10%; font-size: 45px; z-index: 10; filter: drop-shadow(0 0 15px #3b82f6); transition: transform 0.1s linear; }
        .rocket-fire { position: absolute; top: 90%; left: 50%; transform: translateX(-50%); width: 10px; height: 25px; background: linear-gradient(to bottom, #f59e0b, #ef4444, transparent); border-radius: 5px; animation: flicker 0.1s infinite; }
        @keyframes flicker { 0%, 100% { opacity: 0.8; height: 15px; } 50% { opacity: 1; height: 30px; } }
        .game-card { background: linear-gradient(145deg, #1e293b, #0f172a); border: 1px solid #334155; transition: 0.3s; cursor: pointer; position: relative; overflow: hidden; }
        .game-card:hover { border-color: #3b82f6; transform: translateY(-3px); }
        .apple-cell { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; background: #1e293b; border-radius: 12px; transition: 0.2s; font-size: 24px; cursor: pointer; border: 1px solid #334155; }
        .apple-cell.win { background: #059669; border-color: #10b981; }
        .apple-cell.lose { background: #991b1b; border-color: #ef4444; }
        .penalty-target { width: 60px; height: 60px; border-radius: 50%; border: 4px dashed rgba(255,255,255,0.3); transition: 0.2s; cursor: pointer; }
        .penalty-target:hover { background: rgba(59, 130, 246, 0.4); border-color: #3b82f6; }
        #wheel { transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="pb-28">

    <!-- Auth -->
    <div id="authScreen" class="fixed inset-0 z-[100] bg-[#0b0f1a] flex flex-col items-center justify-center p-6 hidden">
        <h1 class="text-6xl font-black italic text-blue-500 mb-2 tracking-tighter">WINNIX EG</h1>
        <p class="text-slate-400 mb-10">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‡Ù†Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
        <input type="text" id="usernameInput" class="w-full max-w-xs bg-slate-800 border border-slate-700 rounded-2xl p-5 text-white font-bold mb-4 outline-none focus:border-blue-500" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠ">
        <button onclick="handleLogin()" class="w-full max-w-xs bg-blue-600 py-5 rounded-2xl font-black text-xl shadow-xl shadow-blue-900/40">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
    </div>

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 bg-[#0b0f1a]/95 backdrop-blur-md border-b border-slate-800 z-50">
        <div class="flex justify-between items-center p-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-700 rounded-xl flex items-center justify-center font-bold text-lg shadow-lg" id="avatarLetter">W</div>
                <div class="flex flex-col">
                    <span id="headerUsername" class="text-sm font-bold">...</span>
                    <span class="text-[10px] text-green-500 font-bold">Ù…ØªØµÙ„</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <div class="bg-slate-900 px-4 py-2 rounded-xl border border-slate-800 text-left">
                    <div class="flex items-center gap-1">
                        <span id="userBalance" class="text-blue-400 font-black text-lg">0.00</span>
                        <span class="text-[10px] text-slate-500 font-bold">EGP</span>
                    </div>
                </div>
                <button onclick="openModal('deposit')" class="bg-blue-600 w-10 h-10 rounded-xl flex items-center justify-center"><i class="fa-solid fa-plus"></i></button>
            </div>
        </div>
    </header>

    <main id="mainContent" class="pt-24 px-4 min-h-screen"></main>

    <!-- Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-[#0b0f1a]/90 backdrop-blur-xl border-t border-slate-800 flex justify-around items-center p-4 z-50">
        <button onclick="router('home')" class="nav-btn flex flex-col items-center text-blue-500" data-page="home"><i class="fa-solid fa-house-chimney text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
        <button onclick="router('crash')" class="nav-btn flex flex-col items-center text-slate-500" data-page="crash"><i class="fa-solid fa-rocket text-xl"></i><span class="text-[10px] mt-1 font-bold">CRASH</span></button>
        <button onclick="router('rewards')" class="nav-btn flex flex-col items-center text-slate-500" data-page="rewards"><i class="fa-solid fa-dharmachakra text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø¹Ø±ÙˆØ¶</span></button>
        <button onclick="router('profile')" class="nav-btn flex flex-col items-center text-slate-500" data-page="profile"><i class="fa-solid fa-user-gear text-xl"></i><span class="text-[10px] mt-1 font-bold">Ø­Ø³Ø§Ø¨ÙŠ</span></button>
    </nav>

    <!-- Modals -->
    <div id="modal" class="fixed inset-0 bg-black/95 z-[100] hidden flex items-center justify-center p-6">
        <div class="bg-slate-900 w-full max-w-sm rounded-3xl border border-slate-800 p-8">
            <h3 id="modalTitle" class="text-2xl font-black mb-6"></h3>
            <div id="modalBody"></div>
            <button onclick="closeModal()" class="w-full mt-6 text-slate-500 font-bold">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-24 left-1/2 -translate-x-1/2 bg-slate-900 border border-blue-500 px-6 py-3 rounded-full shadow-2xl z-[110] transition-all duration-300 opacity-0 pointer-events-none flex items-center gap-3">
        <i id="toastIcon" class="fa-solid fa-circle-info"></i>
        <span id="toastMsg" class="font-bold text-sm"></span>
    </div>

    <script>
        // --- System State ---
        const MIN_BET = 5;
        const PIN_CODE = "208090";
        const STORAGE_KEY = "winnix_v4_local_save";
        
        let state = {
            username: null,
            balance: 0.0,
            lastSpin: 0
        };

        const fakeNames = ["Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø©", "Ø§Ù„ÙØ±Ø¹ÙˆÙ†", "Mido_99", "Capitano", "Ø²ÙŠØ²Ùˆ_Ù…ØµØ±", "Ø§Ù„Ø¨Ø±Ù†Ø³", "Kimo_X", "ÙƒØ§Ø¨ØªÙ†_Ù‡ÙŠÙ…Ùˆ"];

        // --- Crash Engine ---
        let crash = {
            status: 'waiting',
            multiplier: 1.00,
            crashPoint: 0,
            timeLeft: 6,
            userBet: 0,
            hasCashout: false,
            players: [],
            speed: 0.005,
            isProcessingCashout: false
        };

        function init() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                state = JSON.parse(saved);
            }
            if (!state.username) {
                document.getElementById('authScreen').classList.remove('hidden');
            } else {
                updateUI();
                router('home');
            }
            startCrashLoop();
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            updateUI();
        }

        function updateUI() {
            document.getElementById('headerUsername').innerText = state.username || "";
            document.getElementById('userBalance').innerText = state.balance.toFixed(2);
            if(state.username) document.getElementById('avatarLetter').innerText = state.username[0].toUpperCase();
        }

        function showToast(msg, type = 'success') {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.classList.remove('opacity-0');
            setTimeout(() => t.classList.add('opacity-0'), 2000);
        }

        function handleLogin() {
            const val = document.getElementById('usernameInput').value.trim();
            if (val.length < 3) return showToast("Ø§Ù„Ø§Ø³Ù… Ù‚ØµÙŠØ±", "error");
            state.username = val;
            saveData();
            document.getElementById('authScreen').classList.add('hidden');
            router('home');
        }

        // --- CRASH LOGIC ---
        function startCrashLoop() {
            setInterval(() => {
                if (crash.status === 'waiting') {
                    crash.timeLeft -= 0.1;
                    if (crash.timeLeft <= 0) {
                        crash.status = 'flying';
                        crash.speed = 0.005;
                    }
                } else if (crash.status === 'flying') {
                    crash.speed += 0.0001; 
                    crash.multiplier += (crash.multiplier * crash.speed);
                    if (crash.multiplier >= crash.crashPoint) {
                        crash.status = 'crashed';
                        setTimeout(resetCrash, 3000);
                    }
                    updateFakePlayers();
                }
            }, 100);
            resetCrash();
        }

        function resetCrash() {
            crash.status = 'waiting';
            crash.multiplier = 1.00;
            crash.timeLeft = 6;
            crash.userBet = 0;
            crash.hasCashout = false;
            crash.isProcessingCashout = false;
            const r = Math.random();
            if (r < 0.25) crash.crashPoint = 1.00 + Math.random() * 0.15;
            else if (r < 0.8) crash.crashPoint = 1.15 + Math.random() * 1.5;
            else crash.crashPoint = 2.5 + Math.random() * 8;
            
            crash.players = Array(6).fill(0).map(() => ({
                name: fakeNames[Math.floor(Math.random()*fakeNames.length)],
                bet: Math.floor(Math.random()*200) + 10,
                out: false,
                mult: 0
            }));
        }

        function updateFakePlayers() {
            crash.players.forEach(p => {
                if (!p.out && Math.random() < 0.04 && crash.multiplier > 1.1) {
                    p.out = true;
                    p.mult = crash.multiplier;
                }
            });
        }

        // --- APPLES GAME ---
        let appleGame = { active: false, step: 0, bet: 0, grid: [] };
        function startAppleGame(bet) {
            if (bet < MIN_BET) return showToast(`Ø£Ù‚Ù„ Ø±Ù‡Ø§Ù† ${MIN_BET} Ø¬Ù†ÙŠÙ‡`);
            if (state.balance < bet) return showToast("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ");
            state.balance -= bet;
            appleGame = { active: true, step: 0, bet: bet, grid: [] };
            for(let i=0; i<10; i++) {
                let row = [1, 1, 0, 0, 0].sort(() => Math.random() - 0.5);
                appleGame.grid.push(row);
            }
            saveData();
            renderApples(document.getElementById('mainContent'));
        }

        function pickApple(row, col) {
            if(!appleGame.active || row !== appleGame.step) return;
            const cell = event.currentTarget;
            if(appleGame.grid[row][col] === 1) {
                cell.innerHTML = 'ğŸ';
                cell.classList.add('win');
                appleGame.step++;
                if(appleGame.step > 9) {
                    setTimeout(cashoutApples, 500);
                } else {
                    setTimeout(() => renderApples(document.getElementById('mainContent')), 300);
                }
            } else {
                cell.innerHTML = 'ğŸ’£';
                cell.classList.add('lose');
                showToast("Ø®Ø³Ø§Ø±Ø©! ØµØ§Ø¯ÙØª Ù‚Ù†Ø¨Ù„Ø©", "error");
                appleGame.active = false;
                setTimeout(() => router('apples'), 1500);
            }
        }

        function cashoutApples() {
            if(!appleGame.active || appleGame.step === 0) return;
            const multipliers = [1.5, 2.3, 3.8, 6.5, 12, 25, 55, 120, 280, 600];
            const win = appleGame.bet * multipliers[appleGame.step - 1];
            state.balance += win;
            appleGame.active = false;
            saveData();
            showToast(`ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø±Ø¨Ø­Øª ${win.toFixed(2)}`);
            router('apples');
        }

        // --- PENALTY GAME (UPDATED 1.23x logic) ---
        let penaltyGame = { active: false, bet: 0, score: 0 };
        function startPenalty(bet) {
            if (bet < MIN_BET) return showToast(`Ø£Ù‚Ù„ Ø±Ù‡Ø§Ù† ${MIN_BET} Ø¬Ù†ÙŠÙ‡`);
            if (state.balance < bet) return showToast("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ");
            state.balance -= bet;
            penaltyGame = { active: true, bet: bet, score: 0 };
            saveData();
            renderPenalty(document.getElementById('mainContent'));
        }

        function shoot(target) {
            if(!penaltyGame.active) return;
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµØ¹ÙˆØ¨Ø©: ÙØ±ØµØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ØµØ¨Ø­Øª 25% ÙÙ‚Ø· (ÙƒØ§Ù†Øª 60%)
            // Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø³ÙŠØ®Ø³Ø± ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª
            const isGoal = Math.random() > 0.50; 
            
            const goaliePos = Math.floor(Math.random() * 5);
            
            if(isGoal) {
                penaltyGame.score++;
                showToast("Ø¬Ù€ÙˆÙˆÙˆÙˆÙˆÙˆÙ„! ğŸ‰");
                renderPenalty(document.getElementById('mainContent'));
            } else {
                showToast("ØµØ¯Ù‡Ø§ Ø§Ù„Ø­Ø§Ø±Ø³! ğŸ§¤ Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ù…Ø­Ù‚Ù‚Ø©", "error");
                penaltyGame.active = false;
                setTimeout(() => router('penalty'), 1500);
            }
        }

        function cashoutPenalty() {
            if(!penaltyGame.active || penaltyGame.score === 0) return;
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¶Ø§Ø¹Ù: Ø¶Ø±Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº ÙÙŠ 1.23 Ù„ÙƒÙ„ Ù‡Ø¯Ù
            // Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©: Ø§Ù„Ø±Ù‡Ø§Ù† * (1.23 ^ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù)
            const win = penaltyGame.bet * Math.pow(1.73, penaltyGame.score);
            
            state.balance += win;
            penaltyGame.active = false;
            saveData();
            showToast(`Ø³Ø­Ø¨ Ù†Ø§Ø¬Ø­! Ø±Ø¨Ø­Øª ${win.toFixed(2)}`);
            router('penalty');
        }

        // --- DICE GAME ---
        function playDice(choice) {
            const betInput = document.getElementById('diceBet');
            if(!betInput) return;
            const bet = parseFloat(betInput.value);
            if (bet < MIN_BET) return showToast(`Ø£Ù‚Ù„ Ø±Ù‡Ø§Ù† ${MIN_BET} Ø¬Ù†ÙŠÙ‡`);
            if (state.balance < bet) return showToast("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ");
            
            state.balance -= bet;
            const d1 = Math.floor(Math.random()*6) + 1;
            const d2 = Math.floor(Math.random()*6) + 1;
            const sum = d1 + d2;
            
            document.getElementById('dice1').innerText = d1;
            document.getElementById('dice2').innerText = d2;

            let win = 0;
            if (choice === 'under' && sum < 7) win = bet * 2.1;
            else if (choice === 'over' && sum > 7) win = bet * 2.1;
            else if (choice === 'exact' && sum === 7) win = bet * 5.0;

            if (win > 0) {
                state.balance += win;
                showToast(`Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª ${win.toFixed(2)}`, "success");
            } else {
                showToast("Ù„Ù„Ø£Ø³ÙØŒ Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰", "error");
            }
            saveData();
        }

        // --- WHEEL LOGIC ---
        let isSpinning = false;
        function spin() {
            if (isSpinning) return;
            const now = Date.now();
            if (now - state.lastSpin < 3600000) { 
                return showToast("ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù„Ù Ù…Ø±Ø© ÙƒÙ„ Ø³Ø§Ø¹Ø©");
            }

            isSpinning = true;
            const wheel = document.getElementById('wheel');
            const randomDegree = Math.floor(Math.random() * 360) + 3600; 
            wheel.style.transform = `rotate(${randomDegree}deg)`;

            setTimeout(() => {
                isSpinning = false;
                state.lastSpin = Date.now();
                const actualDegree = randomDegree % 360;
                let prize = 0;
                
                if (actualDegree <= 90) prize = 5;
                else if (actualDegree <= 180) prize = 0;
                else if (actualDegree <= 270) prize = 20;
                else prize = 2;

                state.balance += prize;
                saveData();
                showToast(`Ù„Ù‚Ø¯ ÙØ²Øª Ø¨Ù€ ${prize} Ø¬Ù†ÙŠÙ‡!`);
            }, 4000);
        }

        // --- ROUTING ---
        function router(page) {
            const main = document.getElementById('mainContent');
            if(!main) return;
            main.innerHTML = '';
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.replace('text-blue-500', 'text-slate-500'));
            const active = document.querySelector(`[data-page="${page}"]`);
            if(active) active.classList.replace('text-slate-500', 'text-blue-500');

            if(page === 'home') renderHome(main);
            if(page === 'crash') renderCrash(main);
            if(page === 'apples') renderApples(main);
            if(page === 'dice') renderDice(main);
            if(page === 'penalty') renderPenalty(main);
            if(page === 'rewards') renderRewards(main);
            if(page === 'profile') renderProfile(main);
        }

        function renderHome(main) {
            main.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div onclick="router('crash')" class="game-card p-5 rounded-3xl h-44 flex flex-col justify-between shadow-xl border-blue-500/20">
                        <i class="fa-solid fa-rocket text-blue-500 text-4xl"></i>
                        <div><p class="font-black">CRASH</p><p class="text-[10px] text-slate-500 font-bold">ØµØ§Ø±ÙˆØ® Ø§Ù„Ø­Ø¸</p></div>
                    </div>
                    <div onclick="router('penalty')" class="game-card p-5 rounded-3xl h-44 flex flex-col justify-between shadow-xl border-green-500/20">
                        <i class="fa-solid fa-futbol text-green-500 text-4xl"></i>
                        <div><p class="font-black italic">PENALTY</p><p class="text-[10px] text-green-500 font-bold text-xs">Ø¬Ø¯ÙŠØ¯ ğŸ”¥</p></div>
                    </div>
                    <div onclick="router('apples')" class="game-card p-5 rounded-3xl h-44 flex flex-col justify-between shadow-xl border-red-500/20">
                        <i class="fa-solid fa-apple-whole text-red-500 text-4xl"></i>
                        <div><p class="font-black">APPLES</p><p class="text-[10px] text-slate-500 font-bold">Ø´Ø¬Ø±Ø© Ø§Ù„ØªÙØ§Ø­</p></div>
                    </div>
                    <div onclick="router('dice')" class="game-card p-5 rounded-3xl h-44 flex flex-col justify-between shadow-xl border-yellow-500/20">
                        <i class="fa-solid fa-dice text-yellow-500 text-4xl"></i>
                        <div><p class="font-black">UNDER/OVER</p><p class="text-[10px] text-slate-500 font-bold">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø²Ù‡Ø±</p></div>
                    </div>
                </div>
            `;
        }

        function renderCrash(main) {
            main.innerHTML = `
                <div class="crash-canvas-container mb-4">
                    <div class="rocket" id="rocketIcon">ğŸš€<div class="rocket-fire"></div></div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                        <span id="crashMult" class="text-7xl font-black italic">1.00x</span>
                        <span id="crashStatus" class="text-sm mt-3 font-bold text-blue-400">ØªØ­Ù…ÙŠÙ„...</span>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-slate-900 p-4 rounded-2xl border border-slate-800">
                        <p class="text-[10px] text-slate-500 mb-1">Ø§Ù„Ø±Ù‡Ø§Ù† (Ù…ÙÙ† 5)</p>
                        <input type="number" id="cBet" value="10" class="bg-transparent w-full text-xl font-black outline-none text-blue-400">
                    </div>
                    <button id="cBtn" class="bg-blue-600 rounded-2xl font-black text-xl shadow-lg">Ù…Ø±Ø§Ù‡Ù†Ø©</button>
                </div>
                <div class="bg-slate-900 rounded-2xl border border-slate-800 overflow-hidden p-3">
                    <p class="text-[10px] text-slate-500 mb-2 font-bold">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙˆÙ†</p>
                    <div id="cPlayers" class="space-y-2 max-h-40 overflow-y-auto custom-scroll"></div>
                </div>
            `;
            requestAnimationFrame(updateCrashUI);
        }

        function updateCrashUI() {
            const multE = document.getElementById('crashMult');
            if(!multE) return;
            const statusE = document.getElementById('crashStatus');
            const rocketE = document.getElementById('rocketIcon');
            const btnE = document.getElementById('cBtn');
            const playersE = document.getElementById('cPlayers');

            if(crash.status === 'waiting') {
                multE.innerText = `00:0${Math.ceil(crash.timeLeft)}`;
                multE.style.color = "white";
                statusE.innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù‚Ø§Ø¯Ù…...";
                rocketE.style.transform = `translate(0,0)`;
                
                if(crash.userBet > 0) {
                    btnE.innerText = "ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø±Ù‡Ø§Ù†"; 
                    btnE.disabled = true; 
                    btnE.className = "bg-slate-700 text-slate-400 rounded-2xl font-black";
                } else {
                    btnE.innerText = "Ù…Ø±Ø§Ù‡Ù†Ø©"; 
                    btnE.disabled = false; 
                    btnE.className = "bg-blue-600 rounded-2xl font-black";
                    btnE.onclick = () => {
                        const amt = parseFloat(document.getElementById('cBet').value);
                        if(amt < MIN_BET) return showToast(`Ø£Ù‚Ù„ Ø±Ù‡Ø§Ù† ${MIN_BET} Ø¬Ù†ÙŠÙ‡`);
                        if(state.balance < amt) return showToast("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ");
                        state.balance -= amt; 
                        crash.userBet = amt; 
                        saveData();
                    };
                }
            } else if(crash.status === 'flying') {
                multE.innerText = crash.multiplier.toFixed(2) + "x";
                statusE.innerText = "ÙŠØ­Ù„Ù‘Ù‚ Ø§Ù„Ø¢Ù†!";
                const dist = Math.min(crash.multiplier * 35, 230);
                rocketE.style.transform = `translate(${dist}px, -${dist/1.2}px)`;
                
                if(crash.userBet > 0 && !crash.hasCashout) {
                    btnE.innerText = `Ø³Ø­Ø¨ ${(crash.userBet * crash.multiplier).toFixed(2)}`;
                    btnE.disabled = crash.isProcessingCashout; 
                    btnE.className = "bg-yellow-500 text-black rounded-2xl font-black";
                    btnE.onclick = () => {
                        if(crash.isProcessingCashout) return;
                        crash.isProcessingCashout = true;
                        let win = crash.userBet * crash.multiplier;
                        state.balance += win; 
                        crash.hasCashout = true; 
                        saveData();
                        showToast(`Ø±Ø¨Ø­Øª ${win.toFixed(2)}`, "success");
                    };
                } else if(crash.hasCashout) {
                    btnE.innerText = "ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­"; 
                    btnE.disabled = true; 
                    btnE.className = "bg-green-900 text-green-400 rounded-2xl font-black";
                } else {
                    btnE.innerText = "Ø¨Ø¯Ø£ Ø§Ù„Ø¯ÙˆØ± ÙØ¹Ù„ÙŠØ§Ù‹"; 
                    btnE.disabled = true; 
                    btnE.className = "bg-slate-800 text-slate-600 rounded-2xl font-black";
                }
            } else {
                multE.innerText = "CRASHED";
                multE.style.color = "#ef4444";
                statusE.innerText = `Ø§Ù†ÙØ¬Ø± Ø¹Ù†Ø¯ ${crash.multiplier.toFixed(2)}x`;
                rocketE.style.transform = `scale(0)`;
                if(crash.userBet > 0 && !crash.hasCashout) {
                    btnE.innerText = "Ø®Ø³Ø§Ø±Ø©"; 
                    btnE.disabled = true; 
                    btnE.className = "bg-red-900 text-red-500 rounded-2xl font-black";
                }
            }
            playersE.innerHTML = crash.players.map(p => `
                <div class="flex justify-between items-center bg-slate-800/50 p-2 rounded-xl text-[10px]">
                    <span class="font-bold">${p.name}</span>
                    <span class="text-slate-500">${p.bet} EGP</span>
                    <span class="${p.out ? 'text-green-500' : 'text-slate-600'} font-black">${p.out ? p.mult.toFixed(2)+'x' : '...'}</span>
                </div>
            `).join('');
            
            if(document.getElementById('crashMult')) {
                requestAnimationFrame(updateCrashUI);
            }
        }

        function renderPenalty(main) {
            if(!penaltyGame.active) {
                main.innerHTML = `
                    <div class="bg-slate-900 p-8 rounded-3xl border border-slate-800 text-center">
                        <i class="fa-solid fa-futbol text-6xl text-green-500 mb-6 block"></i>
                        <h2 class="text-2xl font-black mb-2 italic">Penalty Shootout</h2>
                        <p class="text-slate-400 text-sm mb-6">Ø³Ø¬Ù„ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ø±Ø¨Ø­ Ø§Ù„Ù…Ù„Ø§ÙŠÙŠÙ†!</p>
                        <input type="number" id="pBet" value="10" class="bg-slate-800 w-full p-4 rounded-2xl text-center text-xl font-black outline-none mb-4 border border-slate-700">
                        <button onclick="startPenalty(parseFloat(document.getElementById('pBet').value))" class="w-full bg-green-600 py-4 rounded-2xl font-black text-xl shadow-xl">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</button>
                    </div>
                `;
            } else {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ø¹Ø±Ø¶Ù‡ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ 1.23
                const potentialWin = penaltyGame.bet * Math.pow(1.23, penaltyGame.score);
                
                main.innerHTML = `
                    <div class="flex justify-between items-center mb-6 bg-slate-900 p-4 rounded-2xl border border-slate-800">
                         <div>
                            <p class="text-[10px] text-slate-500">Ø§Ù„Ø±Ù‡Ø§Ù†: ${penaltyGame.bet} EGP</p>
                            <p class="font-black text-green-500">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: ${penaltyGame.score}</p>
                         </div>
                         <div class="text-right">
                            <p class="text-[10px] text-slate-500 italic">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                            <p class="font-black text-yellow-500">${potentialWin.toFixed(2)} EGP</p>
                         </div>
                    </div>
                    
                    <div class="relative bg-gradient-to-b from-green-800 to-green-600 h-64 rounded-3xl border-4 border-white/20 overflow-hidden flex flex-col items-center justify-center gap-8">
                        <div class="absolute top-0 left-0 right-0 h-1 bg-white/50"></div>
                        <div class="absolute top-0 left-10 bottom-0 w-1 bg-white/20"></div>
                        <div class="absolute top-0 right-10 bottom-0 w-1 bg-white/20"></div>
                        
                        <div class="text-4xl">ğŸ§¤</div>
                        
                        <div class="grid grid-cols-5 gap-4">
                            <div onclick="shoot(0)" class="penalty-target"></div>
                            <div onclick="shoot(1)" class="penalty-target"></div>
                            <div onclick="shoot(2)" class="penalty-target"></div>
                            <div onclick="shoot(3)" class="penalty-target"></div>
                            <div onclick="shoot(4)" class="penalty-target"></div>
                        </div>
                    </div>

                    <button onclick="cashoutPenalty()" class="w-full mt-6 bg-yellow-500 text-black py-4 rounded-2xl font-black text-xl shadow-xl ${penaltyGame.score === 0 ? 'opacity-50 pointer-events-none' : ''}">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</button>
                `;
            }
        }

        function renderApples(main) {
            if(!appleGame.active) {
                main.innerHTML = `
                    <div class="bg-slate-900 p-8 rounded-3xl border border-slate-800 text-center">
                        <i class="fa-solid fa-apple-whole text-6xl text-red-500 mb-6 block"></i>
                        <h2 class="text-2xl font-black mb-2 italic">Apple Fortune</h2>
                        <p class="text-slate-400 text-sm mb-6">Ø§Ø­Ø°Ø± Ø§Ù„Ù‚Ù†Ø§Ø¨Ù„ Ø§Ù„Ù…Ø®ØªØ¨Ø¦Ø©!</p>
                        <input type="number" id="aBet" value="10" class="bg-slate-800 w-full p-4 rounded-2xl text-center text-xl font-black outline-none mb-4 border border-slate-700">
                        <button onclick="startAppleGame(parseFloat(document.getElementById('aBet').value))" class="w-full bg-red-600 py-4 rounded-2xl font-black text-xl shadow-xl">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨</button>
                    </div>
                `;
            } else {
                const multipliers = [1.5, 2.3, 3.8, 6.5, 12, 25, 55, 120, 280, 600];
                let rowsHtml = '';
                for(let i=9; i>=0; i--) {
                    rowsHtml += `
                    <div class="flex items-center gap-3 mb-2 ${i === appleGame.step ? 'opacity-100' : 'opacity-40 pointer-events-none'}">
                        <div class="w-12 text-[10px] font-bold text-slate-500">x${multipliers[i]}</div>
                        <div class="grid grid-cols-5 gap-2 flex-1">`;
                    for(let j=0; j<5; j++) {
                        rowsHtml += `<div onclick="pickApple(${i}, ${j})" class="apple-cell">?</div>`;
                    }
                    rowsHtml += `</div></div>`;
                }
                main.innerHTML = `
                    <div class="flex justify-between items-center mb-4 bg-slate-900 p-4 rounded-2xl border border-slate-800">
                        <div><p class="text-[10px] text-slate-500 font-bold">Ø§Ù„Ø±Ù‡Ø§Ù†: ${appleGame.bet} EGP</p><p class="font-black text-green-500">Ø§Ù„Ø¯ÙˆØ±: ${appleGame.step + 1}/10</p></div>
                        <button onclick="cashoutApples()" class="bg-yellow-500 text-black px-8 py-2 rounded-xl font-black text-sm">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</button>
                    </div>
                    <div class="max-h-[60vh] overflow-y-auto pr-2 custom-scroll">${rowsHtml}</div>
                `;
            }
        }

        function renderDice(main) {
            main.innerHTML = `
                <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800 text-center">
                    <h2 class="text-2xl font-black text-yellow-500 mb-2 italic">UNDER / OVER 7</h2>
                    <p class="text-[10px] text-slate-500 mb-6 font-bold">ØªÙˆÙ‚Ø¹ Ù…Ø¬Ù…ÙˆØ¹ Ø­Ø¬Ø±ÙŠ Ø§Ù„Ù†Ø±Ø¯</p>
                    <div class="flex justify-center gap-4 mb-8">
                        <div id="dice1" class="w-16 h-16 bg-white rounded-xl flex items-center justify-center text-black text-3xl font-bold shadow-lg">?</div>
                        <div id="dice2" class="w-16 h-16 bg-white rounded-xl flex items-center justify-center text-black text-3xl font-bold shadow-lg">?</div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-6">
                        <button onclick="playDice('under')" class="bg-red-600/20 border border-red-500/50 py-4 rounded-xl font-bold flex flex-col items-center hover:bg-red-600/40">
                            <span class="text-xs">Under 7</span><span class="text-[10px] text-red-500">x2.1</span>
                        </button>
                        <button onclick="playDice('exact')" class="bg-blue-600/20 border border-blue-500/50 py-4 rounded-xl font-bold flex flex-col items-center hover:bg-blue-600/40">
                            <span class="text-xs">7 Exact</span><span class="text-[10px] text-blue-500">x5.0</span>
                        </button>
                        <button onclick="playDice('over')" class="bg-green-600/20 border border-green-500/50 py-4 rounded-xl font-bold flex flex-col items-center hover:bg-green-600/40">
                            <span class="text-xs">Over 7</span><span class="text-[10px] text-green-500">x2.1</span>
                        </button>
                    </div>
                    <div class="bg-slate-800 p-4 rounded-2xl border border-slate-700">
                         <p class="text-[10px] text-slate-500 mb-1">Ø±Ù‡Ø§Ù†Ùƒ</p>
                         <input type="number" id="diceBet" value="10" class="bg-transparent text-center w-full text-2xl font-black outline-none text-blue-400">
                    </div>
                </div>
            `;
        }

        function renderRewards(main) {
            main.innerHTML = `
                <div class="flex flex-col items-center py-10 bg-slate-900 rounded-3xl border border-slate-800">
                    <h2 class="text-2xl font-black mb-8 italic">Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h2>
                    <div class="relative">
                        <div id="wheel" class="w-64 h-64 rounded-full border-8 border-slate-800 relative shadow-2xl overflow-hidden" 
                             style="background: conic-gradient(#3b82f6 0% 25%, #ef4444 25% 50%, #8b5cf6 50% 75%, #10b981 75% 100%)">
                            <div class="absolute inset-0 flex items-center justify-center text-[10px] font-bold">
                                <span class="absolute" style="transform: rotate(45deg) translateY(-80px)">5 EGP</span>
                                <span class="absolute" style="transform: rotate(135deg) translateY(-80px)">0 EGP</span>
                                <span class="absolute" style="transform: rotate(225deg) translateY(-80px)">20 EGP</span>
                                <span class="absolute" style="transform: rotate(315deg) translateY(-80px)">2 EGP</span>
                            </div>
                        </div>
                        <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-2 w-4 h-8 bg-white rounded-full z-10 shadow-lg"></div>
                    </div>
                    <button onclick="spin()" class="mt-12 bg-yellow-500 text-black px-12 py-4 rounded-2xl font-black text-xl shadow-xl active:scale-95 transition-transform">Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø© Ù…Ø¬Ø§Ù†Ø§Ù‹</button>
                    <p class="text-[10px] text-slate-500 mt-4 font-bold italic">Ù…ØªØ§Ø­Ø© Ù…Ø±Ø© ÙƒÙ„ Ø³Ø§Ø¹Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø±ØµÙŠØ¯Ùƒ</p>
                </div>
            `;
        }

        function renderProfile(main) {
            main.innerHTML = `
                <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                    <h2 class="text-xl font-black mb-6 italic">Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</h2>
                    <div class="bg-slate-800 p-4 rounded-2xl mb-4 flex justify-between border border-slate-700">
                        <span class="text-slate-400">Ø§Ù„Ø§Ø³Ù…:</span>
                        <span class="font-black text-blue-400">${state.username}</span>
                    </div>
                    <div class="bg-slate-800 p-4 rounded-2xl mb-6 flex justify-between border border-slate-700">
                        <span class="text-slate-400">Ø§Ù„Ø±ØµÙŠØ¯:</span>
                        <span class="font-black text-green-500">${state.balance.toFixed(2)} EGP</span>
                    </div>
                    <button onclick="localStorage.clear(); location.reload();" class="w-full bg-red-600/10 text-red-500 py-4 rounded-2xl font-bold border border-red-500/20">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆÙ…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                </div>
            `;
        }

        function openModal(type) {
            const m = document.getElementById('modal');
            const t = document.getElementById('modalTitle');
            const b = document.getElementById('modalBody');
            m.classList.remove('hidden');
            if(type === 'deposit') {
                t.innerText = "Ø¥ÙŠØ¯Ø§Ø¹ Ø±ØµÙŠØ¯";
                b.innerHTML = `
                    <p class="text-xs text-slate-400 mb-4 font-bold">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</p>
                    <input type="number" id="dAmount" class="w-full bg-slate-800 p-4 rounded-xl mb-3 outline-none border border-slate-700 focus:border-blue-500" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                    <input type="password" id="dPin" class="w-full bg-slate-800 p-4 rounded-xl mb-3 outline-none border border-slate-700 focus:border-blue-500" placeholder="ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„">
                    <button onclick="confirmDep()" class="w-full bg-blue-600 py-4 rounded-xl font-bold shadow-lg">Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</button>
                `;
            }
        }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        function confirmDep() {
            const amtE = document.getElementById('dAmount');
            const pinE = document.getElementById('dPin');
            const amt = parseFloat(amtE.value);
            if(isNaN(amt) || amt <= 0) return showToast("Ø§Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­", "error");
            if(pinE.value === PIN_CODE) {
                state.balance += amt; saveData(); closeModal(); showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­");
            } else showToast("ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­", "error");
        }

        init();
    </script>
</body>
</html>

