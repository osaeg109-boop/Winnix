<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WINNIX Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: white; overflow-x: hidden; }
        .spin-animation { animation: spin 3s cubic-bezier(0.15, 0, 0.15, 1) forwards; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(1080deg); } }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .loading-dots:after { content: ' .'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body class="pb-20">

    <div id="app">
        <!-- Loading State -->
        <div id="loading" class="fixed inset-0 z-[200] bg-[#0f172a] flex flex-col items-center justify-center">
            <div class="w-16 h-16 border-4 border-[#a3ff00] border-t-transparent rounded-full animate-spin mb-4"></div>
            <h1 class="text-2xl font-black">WIN<span class="text-[#a3ff00]">NIX</span></h1>
            <p class="text-slate-500 text-sm mt-2 loading-dots">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
        </div>

        <!-- Auth Screen -->
        <div id="auth-screen" class="hidden min-h-screen flex items-center justify-center p-4">
            <div class="bg-[#1e293b] w-full max-w-md rounded-3xl p-8 border border-slate-700 shadow-2xl">
                <h1 class="text-4xl font-black text-center mb-2">WIN<span class="text-[#a3ff00]">NIX</span></h1>
                <p class="text-center text-slate-400 text-sm mb-8">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø¨Ø­</p>
                <div class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-xs text-slate-500 mr-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input id="auth-email" type="email" placeholder="example@mail.com" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 outline-none focus:border-[#a3ff00] transition-colors">
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs text-slate-500 mr-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input id="auth-password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 outline-none focus:border-[#a3ff00] transition-colors">
                    </div>
                    <div id="auth-error" class="text-red-400 text-xs text-center hidden bg-red-400/10 p-2 rounded-lg"></div>
                    <button id="btn-auth-action" class="w-full bg-[#a3ff00] text-black font-black py-4 rounded-xl shadow-[0_4px_20px_rgba(163,255,0,0.2)] active:scale-95 transition-all">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
                    <p class="text-[10px] text-slate-500 text-center">Ø¨Ù…Ø¬Ø±Ø¯ Ø§Ù„Ø¶ØºØ· Ø³ÙŠØªÙ… ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content" class="hidden">
            <header class="sticky top-0 z-50 bg-[#162032]/80 backdrop-blur-md border-b border-slate-800 p-4 flex justify-between items-center">
                <div class="font-black text-2xl">WIN<span class="text-[#a3ff00]">NIX</span></div>
                <div class="flex items-center gap-3">
                    <div class="bg-slate-900 border border-slate-700 px-4 py-1 rounded-full text-center">
                        <span class="text-[10px] text-slate-500 block">Ø±ØµÙŠØ¯Ùƒ</span>
                        <span id="display-balance" class="text-[#a3ff00] font-black">0.00</span>
                    </div>
                    <button onclick="showModal('profile')" class="p-2 bg-slate-800 rounded-lg"><i data-lucide="user"></i></button>
                </div>
            </header>

            <main class="p-4 max-w-4xl mx-auto space-y-6">
                <!-- Daily Reward -->
                <div class="bg-gradient-to-br from-[#1e293b] to-[#0f172a] p-6 rounded-3xl border border-slate-700 text-center relative overflow-hidden">
                    <div class="absolute -top-4 -right-4 p-4 opacity-5"><i data-lucide="gift" size="120"></i></div>
                    <h2 class="text-xl font-black mb-4 flex items-center justify-center gap-2 text-[#a3ff00]">
                        <i data-lucide="zap"></i> Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                    </h2>
                    <div id="wheel-container" class="w-36 h-36 mx-auto rounded-full border-4 border-slate-800 flex items-center justify-center bg-slate-900 mb-6 shadow-inner transition-all">
                        <span id="wheel-icon" class="text-5xl">ğŸ</span>
                    </div>
                    <div id="reward-status" class="text-slate-400 text-sm mb-4">Ø§Ø±Ø¨Ø­ Ù…Ø¨Ø§Ù„Øº Ù†Ù‚Ø¯ÙŠØ© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©!</div>
                    <button id="btn-spin" class="w-full bg-[#a3ff00] text-black font-black py-3 rounded-xl shadow-lg disabled:opacity-30 disabled:grayscale transition-all">Ø§Ø³Ø­Ø¨ Ù‡Ø¯ÙŠØªÙƒ Ø§Ù„Ø¢Ù†</button>
                </div>

                <!-- Actions -->
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="showModal('deposit')" class="py-4 bg-blue-600 rounded-2xl font-black flex items-center justify-center gap-2 hover:bg-blue-500 active:scale-95 transition-all"><i data-lucide="wallet"></i> Ø¥ÙŠØ¯Ø§Ø¹</button>
                    <button onclick="showModal('withdraw')" class="py-4 bg-emerald-600 rounded-2xl font-black flex items-center justify-center gap-2 hover:bg-emerald-500 active:scale-95 transition-all"><i data-lucide="arrow-down-circle"></i> Ø³Ø­Ø¨</button>
                </div>

                <!-- Game Grid -->
                <h2 class="text-xl font-black mt-8">Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 active:scale-95 transition-all">
                        <div class="bg-red-500/20 w-10 h-10 rounded-xl flex items-center justify-center text-red-500 mb-4"><i data-lucide="rocket"></i></div>
                        <div class="font-black">Aviator X</div>
                        <div class="text-[10px] text-slate-500">Ù‚Ø±ÙŠØ¨Ø§Ù‹..</div>
                    </div>
                    <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 active:scale-95 transition-all">
                        <div class="bg-blue-500/20 w-10 h-10 rounded-xl flex items-center justify-center text-blue-500 mb-4"><i data-lucide="bomb"></i></div>
                        <div class="font-black">Mines Pro</div>
                        <div class="text-[10px] text-slate-500">Ù‚Ø±ÙŠØ¨Ø§Ù‹..</div>
                    </div>
                </div>
            </main>

            <footer class="fixed bottom-0 inset-x-0 bg-[#162032]/95 backdrop-blur-xl border-t border-slate-800 flex justify-around p-3">
                <button class="text-[#a3ff00] flex flex-col items-center"><i data-lucide="gamepad-2"></i><span class="text-[10px]">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
                <button onclick="showModal('deposit')" class="text-slate-400 flex flex-col items-center"><i data-lucide="plus-circle"></i><span class="text-[10px]">Ø´Ø­Ù†</span></button>
                <button onclick="showModal('withdraw')" class="text-slate-400 flex flex-col items-center"><i data-lucide="trending-up"></i><span class="text-[10px]">Ø£Ø±Ø¨Ø§Ø­</span></button>
                <button onclick="showModal('profile')" class="text-slate-400 flex flex-col items-center"><i data-lucide="user-circle"></i><span class="text-[10px]">Ø­Ø³Ø§Ø¨ÙŠ</span></button>
            </footer>
        </div>

        <!-- Modals -->
        <div id="modal-overlay" class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-4 hidden">
            <!-- Deposit -->
            <div id="modal-deposit" class="modal-content bg-[#1e293b] w-full max-w-md rounded-3xl p-8 border border-slate-700 relative hidden">
                <button onclick="hideModal()" class="absolute left-6 top-6 text-slate-500"><i data-lucide="x"></i></button>
                <h2 class="text-2xl font-black mb-6">Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</h2>
                <div class="bg-blue-600/10 border border-blue-500/30 p-4 rounded-xl mb-6 flex justify-between items-center">
                    <div>
                        <p class="text-[10px] text-blue-400">Ø­ÙˆÙ„ Ø¥Ù„Ù‰ ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´:</p>
                        <span class="font-mono text-xl font-bold text-white">01014879247</span>
                    </div>
                    <button onclick="copyNumber()" class="bg-blue-600 p-2 rounded-lg text-white"><i data-lucide="copy" size="16"></i></button>
                </div>
                <div class="space-y-4">
                    <input id="dep-phone" type="text" placeholder="Ø±Ù‚Ù…Ùƒ Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-800 outline-none">
                    <input id="dep-amount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø´Ø­Ù†Ù‡" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-800 outline-none">
                    <button id="btn-confirm-dep" class="w-full bg-[#a3ff00] text-black font-black py-4 rounded-xl">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙØ¹ÙŠÙ„</button>
                </div>
            </div>

            <!-- Withdraw -->
            <div id="modal-withdraw" class="modal-content bg-[#1e293b] w-full max-w-md rounded-3xl p-8 border border-slate-700 relative hidden">
                <button onclick="hideModal()" class="absolute left-6 top-6 text-slate-500"><i data-lucide="x"></i></button>
                <h2 class="text-2xl font-black mb-6 text-emerald-500">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h2>
                <div class="space-y-4">
                    <input id="wd-phone" type="text" placeholder="Ø±Ù‚Ù… Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-800 outline-none">
                    <input id="wd-amount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ù„Ø£Ø¯Ù†Ù‰ 50)" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-800 outline-none">
                    <div id="wd-error" class="text-red-400 text-xs text-center hidden"></div>
                    <button id="btn-confirm-wd" class="w-full bg-emerald-600 text-white font-black py-4 rounded-xl">ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨</button>
                </div>
            </div>

            <!-- Profile -->
            <div id="modal-profile" class="modal-content bg-[#1e293b] w-full max-w-md rounded-3xl p-8 border border-slate-700 relative hidden">
                <button onclick="hideModal()" class="absolute left-6 top-6 text-slate-500"><i data-lucide="x"></i></button>
                <div class="text-center pt-4">
                    <div class="w-16 h-16 bg-slate-800 rounded-full mx-auto mb-4 flex items-center justify-center border border-[#a3ff00]"><i data-lucide="user" class="text-[#a3ff00]"></i></div>
                    <h2 id="prof-email" class="font-bold text-sm">---</h2>
                    <p id="prof-id" class="text-slate-500 text-[10px] mb-6">ID: WIN-000000</p>
                    <div class="bg-slate-900 p-4 rounded-2xl mb-6">
                        <p class="text-slate-500 text-[10px] mb-1">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</p>
                        <p id="prof-balance" class="text-[#a3ff00] text-2xl font-black">0.00 EGP</p>
                    </div>
                    <button id="btn-logout" class="w-full bg-red-500/10 text-red-500 border border-red-500/20 py-3 rounded-xl">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Integration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDhHkYb1tFSSbxaQejvYl2vrI5fN1MVpcs",
            authDomain: "chatu-e5f5f.firebaseapp.com",
            projectId: "chatu-e5f5f",
            storageBucket: "chatu-e5f5f.firebasestorage.app",
            messagingSenderId: "625361934723",
            appId: "1:625361934723:web:b1b204c1d538a5e875beb6"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'winnix-master-app';

        let currentUser = null;
        let userData = null;

        lucide.createIcons();

        // 1. Auth Flow: Single Button Login/Signup
        document.getElementById('btn-auth-action').onclick = async () => {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-password').value;
            const errDiv = document.getElementById('auth-error');
            
            if(!email || !pass) {
                errDiv.innerText = "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„";
                errDiv.classList.remove('hidden');
                return;
            }

            errDiv.classList.add('hidden');
            try {
                // Try login
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (e) {
                // If fails, try signup
                try {
                    const userCred = await createUserWithEmailAndPassword(auth, email, pass);
                    // Create Profile
                    await setDoc(doc(db, 'artifacts', appId, 'users', userCred.user.uid, 'profile'), {
                        balance: 0,
                        email: email,
                        userId: `WIN-${Math.floor(100000 + Math.random() * 900000)}`,
                        registeredAt: Date.now()
                    });
                } catch (signupErr) {
                    errDiv.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£: " + signupErr.message.split('/')[1]?.replace(')', '') || "ÙØ´Ù„Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©";
                    errDiv.classList.remove('hidden');
                }
            }
        };

        // 2. Auth State Observer (REVISED)
        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user && !user.isAnonymous) {
                // Authenticated User
                const profileRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profile');
                onSnapshot(profileRef, (snap) => {
                    if (snap.exists()) {
                        userData = snap.data();
                        renderData();
                    }
                }, (err) => console.error("Firestore Error:", err));
                
                checkDailyReward();
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
            } else {
                // Show Auth Screen
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('main-content').classList.add('hidden');
            }
            document.getElementById('loading').classList.add('hidden');
        });

        function renderData() {
            if(!userData) return;
            document.getElementById('display-balance').innerText = userData.balance.toFixed(2);
            document.getElementById('prof-balance').innerText = userData.balance.toFixed(2) + " EGP";
            document.getElementById('prof-email').innerText = userData.email;
            document.getElementById('prof-id').innerText = `ID: ${userData.userId}`;
        }

        // 3. Daily Reward Logic
        async function checkDailyReward() {
            if(!currentUser) return;
            const rewardRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'rewards', 'daily');
            const snap = await getDoc(rewardRef);
            if (snap.exists()) {
                const last = snap.data().timestamp;
                if (Date.now() - last < 86400000) {
                    disableSpin();
                }
            }
        }

        function disableSpin() {
            const btn = document.getElementById('btn-spin');
            btn.disabled = true;
            btn.innerText = "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ù‡Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ…";
        }

        document.getElementById('btn-spin').onclick = async () => {
            const btn = document.getElementById('btn-spin');
            const wheel = document.getElementById('wheel-container');
            const icon = document.getElementById('wheel-icon');
            
            btn.disabled = true;
            wheel.classList.add('spin-animation');

            setTimeout(async () => {
                wheel.classList.remove('spin-animation');
                const reward = parseFloat((Math.random() * 3 + 1).toFixed(2));
                icon.innerText = "ğŸ’¸";
                document.getElementById('reward-status').innerHTML = `<span class="text-[#a3ff00] font-bold">Ø±Ø¨Ø­Øª ${reward} EGP Ù…ÙƒØ§ÙØ£Ø©!</span>`;
                
                await updateDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'profile'), {
                    balance: userData.balance + reward
                });
                await setDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'rewards', 'daily'), {
                    timestamp: Date.now()
                });
                disableSpin();
            }, 3000);
        };

        // 4. Modals & UI Actions
        window.showModal = (id) => {
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.querySelectorAll('.modal-content').forEach(m => m.classList.add('hidden'));
            document.getElementById('modal-' + id).classList.remove('hidden');
        };

        window.hideModal = () => {
            document.getElementById('modal-overlay').classList.add('hidden');
        };

        window.copyNumber = () => {
            navigator.clipboard.writeText("01014879247");
            const btn = document.querySelector('#modal-deposit button i');
            btn.setAttribute('data-lucide', 'check');
            lucide.createIcons();
            setTimeout(() => {
                btn.setAttribute('data-lucide', 'copy');
                lucide.createIcons();
            }, 2000);
        };

        document.getElementById('btn-confirm-dep').onclick = () => {
            const ph = document.getElementById('dep-phone').value;
            const am = document.getElementById('dep-amount').value;
            if(!ph || !am) return;
            const msg = `Ø¥ÙŠØ¯Ø§Ø¹ Ø¬Ø¯ÙŠØ¯ Ù…Ù†: ${userData.userId}%0AØ§Ù„Ø±Ù‚Ù…: ${ph}%0AØ§Ù„Ù…Ø¨Ù„Øº: ${am}`;
            window.open(`https://wa.me/201012265953?text=${msg}`);
            hideModal();
        };

        document.getElementById('btn-confirm-wd').onclick = async () => {
            const ph = document.getElementById('wd-phone').value;
            const am = parseFloat(document.getElementById('wd-amount').value);
            const err = document.getElementById('wd-error');
            
            if(!ph || isNaN(am) || am < 50) {
                err.innerText = "Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ 50 Ø¬Ù†ÙŠÙ‡";
                err.classList.remove('hidden');
                return;
            }
            if(userData.balance < am) {
                err.innerText = "Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ";
                err.classList.remove('hidden');
                return;
            }

            await updateDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'profile'), {
                balance: userData.balance - am
            });
            const msg = `Ø³Ø­Ø¨ Ø£Ø±Ø¨Ø§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userData.userId}%0AØ§Ù„Ø±Ù‚Ù…: ${ph}%0AØ§Ù„Ù…Ø¨Ù„Øº: ${am}`;
            window.open(`https://wa.me/201012265953?text=${msg}`);
            hideModal();
        };

        document.getElementById('btn-logout').onclick = () => signOut(auth);

    </script>
</body>
</html>

